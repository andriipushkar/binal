# Binance Balance Tracker

## Опис Проєкту

Цей проєкт є простим Python застосунком для отримання інформації про спотовий та ф'ючерсний баланс з твого акаунта Binance за допомогою офіційного API. Проєкт структуровано як Python пакет для забезпечення модульності та можливості повторного використання коду.

Застосунок може:
- Безпечно завантажувати API ключі.
- Підключатися до Binance API.
- Отримувати деталі спотового та ф'ючерсного (USDT-M) балансу.
- Оцінювати вартість активів у USD (наскільки це можливо, намагаючись використовувати прямі пари зі стейблкоїнами або конвертацію через BTC/BNB).
- Виводити інформацію про спотовий баланс у вигляді форматованої таблиці.
- Логувати процес виконання та будь-які попередження/помилки.
- Зберігати дані балансу у структурованому (JSON) та читабельному (TXT) форматах.
- Можливість запускати повний функціонал або окремі його частини (наприклад, лише спотовий баланс) з різних скриптів.

## Особливості

- Модульна структура коду (розділення API взаємодії, обробки даних та логіки запуску).
- Використання Python пакета для кращої організації.
- Безпечне керування API ключами через файл `.env`.
- Гнучке логування з фіксацією часу та рівня важкості повідомлень.
- Збереження результатів у структурованому (JSON) та читабельному (TXT) форматах.
- Можливість запускати повний функціонал або окремі його частини (наприклад, лише спотовий баланс) з різних скриптів.

## Структура Проєкту

Проєкт має наступну структуру папок та файлів:

pro1/                                  # Коренева папка проєкту
├── balance_binance.py                 # Зовнішній скрипт: отримує повний баланс (спот + ф'ючерси), зберігає в balance_output.*
├── spot_account_binance.py            # Зовнішній скрипт: отримує лише спотовий баланс, зберігає в spot_account_binance_output.*
├── futures_account_binance.py         # Зовнішній скрипт: отримує лише ф'ючерсний баланс, зберігає в futures_account_binance_output.*
├── balance/                           # Основний Python пакет проєкту
│   ├── main.py                        # Головна точка входу пакета (запускається через python -m balance.main)
│   ├── logs/                          # Папка для файлів логів, згенерованих скриптами в balance/
│   │   └──```markdown
# Binance Balance Tracker


pro1/                                  # Коренева папка проєкту
├── balance_binance.py                 # Зовнішній скрипт: отримує повний баланс (спот + ф'ючерси), зберігає в balance_output.*
├── spot_account_binance.py            # Зовнішній скрипт: отримує лише спотовий баланс, зберігає в spot_account_binance_output.*
├── futures_account_binance.py         # Зовнішній скрипт: отримує лише ф'ючерсний баланс, зберігає в futures_account_binance_output.*
├── balance/                           # Основний Python пакет проєкту
│   ├── main.py                        # Головна точка входу пакета (запускається через python -m balance.main)
│   ├── logs/                          # Папка для файлів логів, згенерованих скриптами в balance/
│   │   └──YYYY-MM-DD_HH-MM-SS*.log    # Файли логів
│   ├── output/                        # Папка для вихідних файлів JSON/TXT, згенерованих скриптами
│   │   ├── balance_output.json
│   │   ├── balance_output.txt
│   │   ├── spot_account_binance_output.json
│   │   ├── spot_account_binance_output.txt
│   │   ├── futures_account_binance_output.json
│   │   └── futures_account_binance_output.txt
│   ├── init.py                    # Позначає balance як Python пакет
│   ├── api.py                         # Модуль: функції для взаємодії з Binance API
│   └── data_processing.py             # Модуль: функції для обробки, форматування та збереження даних
└── service/                           # Папка: службові файли
└── .env                           # Файл: містить API ключі


## Передумови

Перш ніж запустити проєкт, переконайтеся, що у вас встановлено:

- **Python 3.7+:** Використовуйте відповідну версію Python.
- **Binance акаунт:** Необхідний для отримання API ключів.
- **API ключі Binance:** Потрібно створити API Key та Secret Key у налаштуваннях вашого акаунта на Binance. **Настійно рекомендується надати ключам лише необхідні дозволи (наприклад, "Reading" для отримання балансу) та обмежити доступ за IP-адресою для підвищення безпеки.**

## Встановлення

1.  **Клонуйте репозиторій (якщо він у вас є) або створіть описану структуру папок вручну.** Переконайтеся, що ви перебуваєте у кореневій папці проєкту (`pro1/`).
2.  **Встановіть необхідні Python бібліотеки:** Відкрийте термінал у кореневій папці проєкту (`pro1/`) та виконайте команду:
    ```bash
    pip install python-binance python-dotenv pandas
    ```

## Налаштування API Ключів (Безпека!)

**Ніколи не зберігайте ваші Secret Key та API Key безпосередньо у коді або у файлах, які можуть потрапити до системи контролю версій (наприклад, Git)!**

Цей проєкт використовує файл `.env` для безпечного зберігання ключів.

1.  **Створіть папку `service`** у кореневій папці проєкту (`pro1/`).
2.  **Створіть файл з назвою `.env`** всередині папки `service`.
3.  **Відкрийте файл `.env`** у текстовому редакторі (наприклад, VS Code) та додайте наступні два рядки, **замінивши `<ТВІЙ_API_KEY>` та `<ТВІЙ_SECRET_KEY>` на ваші реальні API ключі Binance**:

    ```dotenv
    BINANCE_API_KEY=<ТВІЙ_API_KEY>
    BINANCE_SECRET_KEY=<ТВІЙ_SECRET_KEY>
    ```
    Збережіть файл.

Ваш скрипт автоматично знайде цей файл завдяки використанню бібліотеки `python-dotenv` та правильному розрахунку шляху.

## Як Запустити

Всі основні скрипти запускаються з **кореневої папки проєкту** (`pro1/`).

1.  Відкрийте термінал у кореневій папці проєкту (`pro1/`).
2.  Виконайте одну з наступних команд залежно від того, який функціонал ви хочете запустити:

    -   **Запустити головний файл пакета (повний функціонал):**
        ```bash
        python -m balance.main
        ```
        Ця команда запускає `main.py` як модуль пакета `balance`. Отримає повний баланс (спот + ф'ючерси), виведе в консоль/лог та збереже у `balance/output/balance_output.*`.

    -   **Запустити зовнішній скрипт для повного балансу:**
        ```bash
        python balance_binance.py
        ```
        Ця команда запускає скрипт `balance_binance.py`. Він імпортує та використовує функції з пакета `balance` для отримання повного балансу, виведення в консоль/лог та збереження у `balance/output/balance_output.*`.

    -   **Запустити зовнішній скрипт для спотового балансу:**
        ```bash
        python spot_account_binance.py
        ```
        Ця команда запускає скрипт `spot_account_binance.py`. Він імпортує та використовує функції з пакета `balance` лише для отримання спотового балансу, його виведення в консоль/лог та збереження у `balance/output/spot_account_binance_output.*`.

    -   **Запустити зовнішній скрипт для ф'ючерсного балансу:**
        ```bash
        python futures_account_binance.py
        ```
        Ця команда запускає скрипт `futures_account_binance.py`. Він імпортує та використовує функції з пакета `balance` лише для отримання ф'ючерсного балансу, його виведення в консоль/лог та збереження у `balance/output/futures_account_binance_output.*`.

## Огляд Коду

-   **`pro1/balance/__init__.py`:** Порожній файл, який потрібен, щоб Python розглядав папку `balance` як пакет.
-   **`pro1/balance/api.py`:** Містить функції, що безпосередньо взаємодіють з Binance API.
-   **`pro1/balance/data_processing.py`:** Містить функції для обробки та збереження даних.
-   **`pro1/balance/main.py`:** Головний файл пакета. Налаштовує логування, викликає функції з `api.py` та `data_processing.py` для виконання повного циклу (отримання обох балансів, форматування, збереження). Призначений для запуску як модуль (`python -m balance.main`).
-   **`pro1/balance_binance.py`**, **`pro1/spot_account_binance.py`**, **`pro1/futures_account_binance.py`:** Зовнішні скрипти, що імпортують та використовують функції з пакета `balance` для виконання конкретних завдань (повний баланс, тільки спот, тільки ф'ючерси) та збереження результатів у файли з різними іменами.

## Огляд Функцій

Ось список функцій, реалізованих у модулях пакету `balance`:

### Модуль `balance/api.py`

-   `load_api_keys(dotenv_file_path)`:
    -   **Призначення:** Завантажує твої API ключі (API Key та Secret Key) з файлу `.env` за вказаним шляхом.
    -   **Параметри:** `dotenv_file_path` (рядок) - шлях до файлу `.env`.
    -   **Що повертає:** Кортеж з двома значеннями: `(api_key, secret_key)`. Якщо ключі не вдалося завантажити або знайти файл, повертає `(None, None)`.

-   `initialize_binance_client(api_key, secret_key)`:
    -   **Призначення:** Створює та ініціалізує об'єкт клієнта `python-binance`, який використовується для всіх запитів до Binance API.
    -   **Параметри:** `api_key` (рядок), `secret_key` (рядок) - твої API ключі.
    -   **Що повертає:** Об'єкт клієнта Binance (`binance.client.Client`) у випадку успіху, або `None`, якщо сталася помилка при підключенні чи ініціалізації.

-   `get_price_in_usd(symbol, client)`:
    -   **Призначення:** Отримує поточну оціночну ціну заданого символу (активу) в USD. Спочатку шукає пряму пару зі стейблкоїном (USDT, BUSD), а якщо не знаходить, намагається конвертувати через пари з BTC або BNB. Використовує кешування цін.
    -   **Параметри:** `symbol` (рядок) - тікер активу (наприклад, 'ETH'), `client` (об'єкт `binance.client.Client`) - ініціалізований клієнт API.
    -   **Що повертає:** Число з оціночною ціною в USD, або `None`, якщо ціну отримати не вдалося після всіх спроб.

-   `get_spot_balance(client)`:
    -   **Призначення:** Робить запит до Binance API для отримання інформації про твій спотовий гаманець. Перебирає всі активи, що мають баланс > 0, отримує їхню оціночну вартість у USD за допомогою `get_price_in_usd`.
    -   **Параметри:** `client` (об'єкт `binance.client.Client`) - ініціалізований клієнт API.
    -   **Що повертає:** Кортеж з двома значеннями: список словників, що містять деталі кожного активу на споті (Актив, Вільний, Заблокований, Всього, Вартість в USD - числове значення або None), та загальну оціночну суму спотового балансу в USD.

-   `get_futures_balance(client)`:
    -   **Призначення:** Робить запит до Binance API для отримання інформації про твій ф'ючерсний гаманець USDT-M. Шукає інформацію про актив USDT (баланс гаманця та нереалізований PNL).
    -   **Параметри:** `client` (об'єкт `binance.client.Client`) - ініціалізований клієнт API.
    -   **Що повертає:** Кортеж з двома значеннями: загальний баланс USDT-M (сума балансу гаманця та PNL) та словник з деталями активу USDT на ф'ючерсах.

### Модуль `balance/data_processing.py`

-   `format_spot_balance_table(spot_balances_list)`:
    -   **Призначення:** Бере список словників зі спотовим балансом (отриманий від `get_spot_balance`) і форматує його у вигляді привабливого рядка-таблиці за допомогою бібліотеки `pandas`, готового для виводу у консоль чи лог.
    -   **Параметри:** `spot_balances_list` (список словників) - дані спотового балансу.
    -   **Що повертає:** Форматований рядок з таблицею спотового балансу.

-   `save_to_json(data, output_dir_path, file_name)`:
    -   **Призначення:** Зберігає передані структуровані дані (`data`, зазвичай словник або список) у файл JSON з вказаним іменем (`file_name`) у вказаній вихідній директорії (`output_dir_path`).
    -   **Параметри:** `data` (dict або list) - дані для збереження, `output_dir_path` (рядок) - шлях до папки для збереження, `file_name` (рядок) - ім'я JSON файлу.
    -   **Що повертає:** `True`, якщо збереження успішне, `False` у випадку помилки.

-   `save_to_txt(data_string, output_dir_path, file_name)`:
    -   **Призначення:** Зберігає переданий текстовий вміст (`data_string`) у файл TXT з вказаним іменем (`file_name`) у вказаній вихідній директорії (`output_dir_path`).
    -   **Параметри:** `data_string` (рядок) - текстовий вміст для збереження, `output_dir_path` (рядок) - шлях до папки для збереження, `file_name` (рядок) - ім'я TXT файлу.
    -   **Що повертає:** `True`, якщо збереження успішне, `False` у випадку помилки.

## Вихідні Файли

Після запуску відповідних скриптів у папці `pro1/balance/output/` з'являться файли:

-   `balance_output.json`, `balance_output.txt`: Містять повний звіт (спот + ф'ючерси), згенеровані `main.py` або `balance_binance.py`.
-   `spot_account_binance_output.json`, `spot_account_binance_output.txt`: Містять звіт лише про спотовий баланс, згенеровані `spot_account_binance.py`.
-   `futures_account_binance_output.json`, `futures_account_binance_output.txt`: Містять звіт лише про ф'ючерсний баланс, згенеровані `futures_account_binance.py`.

У папці `pro1/balance/logs/` будуть створюватися лог-файли з датою та часом виконання, а також суфіксом (`_spot.log` або `_futures.log`) для розрізнення скриптів.

## Обробка Помилок

Проєкт включає базову обробку помилок (наприклад, проблеми з підключенням до API, невірні ключі, відсутність .env файлу). Помилки та попередження логуються. Детальнішу інформацію про будь-які проблеми можна знайти у відповідних лог-файлах у папці `logs/`.

## Подальші Вдосконалення

Проєкт можна розширити, додавши:

-   Обробку інших типів ф'ючерсів (COIN-M).
-   Додавання інших стейблкоїнів для оцінки вартості активів.
-   Фільтрацію "копійчаних" (dust) балансів.
-   Отримання іншої інформації з Binance API (історії ордерів, відкритих позицій тощо) шляхом додавання нових функцій до `balance/api.py` та відповідної логіки обробки/відображення.
-   Використання отриманих даних для аналізу або візуалізації.
-   Створення графічного або веб-інтерфейсу для більш зручного використання.